<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projectile Physics Engine (A/L Sri Lanka)</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,700;1,400&family=EB+Garamond:ital,wght@1,400;1,700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        math: ['EB Garamond', 'serif'],
                    },
                    colors: {
                        brand: {
                            bg: '#0f172a',
                            panel: '#1e293b',
                            accent: '#38bdf8',
                            'accent-hover': '#0ea5e9',
                            border: '#334155',
                        }
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-brand-bg text-slate-50 font-sans h-full flex flex-col overflow-hidden">
    <div class="max-w-[1400px] mx-auto w-full h-full flex flex-col p-4 gap-4">
        <header class="text-center pb-2 border-b border-brand-border">
            <h1 class="text-3xl font-bold text-brand-accent tracking-tight">Projectile Motion Simulator</h1>
            <p class="text-slate-400 text-sm uppercase tracking-widest mt-1">Advanced Level Physics - Sri Lanka</p>
        </header>

        <main class="flex flex-col lg:flex-row gap-4 flex-1 min-h-0">
            <!-- Left Column: Simulation & Graphs -->
            <div class="flex-[3] flex flex-col gap-4 min-h-0">
                <!-- Simulation Area -->
                <div
                    class="flex-[2] bg-black rounded-xl border border-brand-border relative overflow-hidden shadow-2xl shadow-sky-900/10">
                    <canvas id="gameCanvas" class="w-full h-full block"></canvas>

                    <!-- Overlay Stats -->
                    <div class="absolute top-4 left-4 bg-brand-panel/80 backdrop-blur-md p-4 rounded-lg border border-brand-border font-mono text-sm pointer-events-none shadow-lg"
                        id="statsDisplay">
                        <div class="mb-1">Range (R): <span id="val-range"
                                class="text-brand-accent font-bold">0.00</span>
                            m
                        </div>
                        <div class="mb-1">Max Height (H): <span id="val-height"
                                class="text-brand-accent font-bold">0.00</span> m</div>
                        <div>Time (T): <span id="val-time" class="text-brand-accent font-bold">0.00</span> s</div>
                    </div>
                </div>

                <!-- Graphs Section (Preview Area) -->
                <div class="flex-1 bg-brand-panel rounded-xl border border-brand-border p-4 shadow-inner min-h-[160px]">
                    <h3 class="text-xs uppercase tracking-widest text-slate-500 mb-2 font-bold">Physics Preview (Graphs)
                    </h3>
                    <canvas id="graphCanvas" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- Controls Panel -->
            <aside
                class="flex-1 bg-brand-panel p-5 rounded-xl border border-brand-border overflow-y-auto flex flex-col gap-6 shadow-xl min-w-[320px]">
                <!-- Parameters -->
                <section class="space-y-4">
                    <h3
                        class="text-brand-accent font-bold border-b border-brand-border pb-2 text-sm uppercase tracking-wider">
                        Parameters</h3>
                    <div class="space-y-3">
                        <label class="block text-sm">
                            <div class="flex justify-between mb-1 text-slate-300">
                                <span>Initial Velocity (u)</span>
                                <span class="text-brand-accent font-bold"><span id="disp-velocity">20</span> m/s</span>
                            </div>
                            <input type="range" id="inp-velocity" min="0" max="100" step="0.1" value="20"
                                class="w-full transition-all accent-brand-accent">
                        </label>
                        <label class="block text-sm">
                            <div class="flex justify-between mb-1 text-slate-300">
                                <span>Launch Angle (θ)</span>
                                <span class="text-brand-accent font-bold"><span id="disp-angle">45</span>°</span>
                            </div>
                            <input type="range" id="inp-angle" min="0" max="90" step="1" value="45"
                                class="w-full transition-all accent-brand-accent">
                        </label>
                        <label class="block text-sm">
                            <div class="flex justify-between mb-1 text-slate-300">
                                <span>Gravity (g)</span>
                                <span class="text-brand-accent font-bold"><span id="disp-gravity">9.81</span>
                                    m/s²</span>
                            </div>
                            <div class="flex gap-2">
                                <input type="number" id="inp-gravity" value="9.81" step="0.01"
                                    class="bg-brand-bg border border-brand-border text-slate-100 p-2 rounded w-full focus:outline-none focus:ring-1 focus:ring-brand-accent transition-all">
                                <select id="sel-planet"
                                    class="bg-brand-bg border border-brand-border text-slate-100 p-2 rounded w-full focus:outline-none focus:ring-1 focus:ring-brand-accent transition-all">
                                    <option value="9.81">Earth (9.81)</option>
                                    <option value="1.62">Moon (1.62)</option>
                                    <option value="3.71">Mars (3.71)</option>
                                    <option value="24.79">Jupiter (24.79)</option>
                                </select>
                            </div>
                        </label>
                    </div>
                </section>

                <!-- Environment & Navigation -->
                <div class="grid grid-cols-1 gap-6">
                    <section class="space-y-3">
                        <h3
                            class="text-brand-accent font-bold border-b border-brand-border pb-1 text-sm uppercase tracking-wider">
                            Environment</h3>
                        <label class="flex items-center gap-3 cursor-pointer group select-none">
                            <input type="checkbox" id="chk-air-resistance"
                                class="w-4 h-4 rounded border-brand-border text-brand-accent focus:ring-brand-accent bg-brand-bg">
                            <span class="text-sm group-hover:text-brand-accent transition-colors">Apply Air
                                Resistance</span>
                        </label>
                    </section>

                    <section class="space-y-3">
                        <h3
                            class="text-brand-accent font-bold border-b border-brand-border pb-1 text-sm uppercase tracking-wider">
                            Zoom & View</h3>
                        <label class="block text-sm">
                            <div class="flex justify-between mb-1 text-slate-300">
                                <span>Viewport Zoom</span>
                                <span class="text-brand-accent font-bold"><span id="disp-zoom">100</span>%</span>
                            </div>
                            <input type="range" id="inp-zoom" min="0.1" max="5" step="0.1" value="1"
                                class="w-full accent-brand-accent">
                        </label>
                        <button id="btn-zoom-reset"
                            class="bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-4 rounded text-xs transition-all w-full font-bold">Reset
                            Viewport</button>
                    </section>
                </div>

                <!-- Main Actions -->
                <section class="flex gap-2 pt-2 border-t border-brand-border mt-auto">
                    <button id="btn-fire"
                        class="flex-[2] bg-brand-accent hover:bg-brand-accent-hover text-brand-bg py-3 rounded-lg font-bold text-lg transition-transform active:scale-95 shadow-lg shadow-sky-500/20 uppercase tracking-widest">Fire</button>
                    <button id="btn-reset"
                        class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-lg font-bold transition-all transition-transform active:scale-95 uppercase tracking-wider">Reset</button>
                </section>

                <!-- Learning Hub -->
                <section
                    class="bg-sky-500/5 border border-sky-500/20 rounded-xl overflow-hidden shadow-inner flex flex-col min-h-0">
                    <div class="flex justify-between items-center bg-sky-500/10 p-3 flex-shrink-0">
                        <h3 class="text-brand-accent font-bold text-xs uppercase tracking-widest">Learning Hub</h3>
                        <button id="btn-toggle-hub"
                            class="text-xs bg-sky-500/20 hover:bg-sky-500/40 px-3 py-1 rounded transition-colors uppercase font-bold tracking-tighter">Expand</button>
                    </div>
                    <div id="hub-content" class="hidden p-4 space-y-4 overflow-y-auto">
                        <!-- Tools -->
                        <div class="space-y-2">
                            <h4 class="text-[0.65rem] uppercase tracking-widest text-slate-500 font-bold mb-2">Visual
                                Analysis</h4>
                            <label class="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" id="chk-show-vectors"
                                    class="w-4 h-4 rounded border-brand-border text-brand-accent focus:ring-brand-accent bg-brand-bg">
                                <span class="text-sm">Velocity Vectors (v, vx, vy)</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" id="chk-show-ideal"
                                    class="w-4 h-4 rounded border-brand-border text-brand-accent focus:ring-brand-accent bg-brand-bg">
                                <span class="text-sm">Compare with Ideal Path</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" id="chk-keep-history"
                                    class="w-4 h-4 rounded border-brand-border text-brand-accent focus:ring-brand-accent bg-brand-bg">
                                <span class="text-sm">Show Trajectory History</span>
                            </label>
                        </div>

                        <!-- Energy Dashboard -->
                        <div class="space-y-3 pt-2 border-t border-brand-border">
                            <h4 class="text-[0.65rem] uppercase tracking-widest text-slate-500 font-bold">Energy
                                Conservation (J/kg)</h4>
                            <div class="space-y-2 text-[0.7rem] uppercase font-mono">
                                <div class="flex justify-between mb-1"><span>Kinetic (KE)</span><span
                                        id="val-ke">0.0</span></div>
                                <div class="w-full bg-slate-800 h-1 rounded-full">
                                    <div id="bar-ke" class="bg-brand-accent h-full transition-all duration-75"
                                        style="width: 0%"></div>
                                </div>

                                <div class="flex justify-between mb-1"><span>Potential (PE)</span><span
                                        id="val-pe">0.0</span></div>
                                <div class="w-full bg-slate-800 h-1 rounded-full">
                                    <div id="bar-pe" class="bg-red-500 h-full transition-all duration-75"
                                        style="width: 0%"></div>
                                </div>

                                <div class="flex justify-between mb-1 pt-1 border-t border-brand-border/30"><span>Total
                                        Energy</span><span id="val-te">0.0</span></div>
                            </div>
                        </div>

                        <!-- Formulas -->
                        <div
                            class="formula-box bg-brand-bg/60 p-4 rounded-lg border border-sky-500/10 font-math italic text-lg leading-relaxed shadow-lg">
                            <p class="mb-3 hover:text-brand-accent transition-colors"><strong
                                    class="not-italic font-sans text-[0.7rem] block text-brand-accent uppercase tracking-widest mb-1">Range
                                    (R)</strong> (u² sin 2θ) / g</p>
                            <p class="mb-3 hover:text-brand-accent transition-colors"><strong
                                    class="not-italic font-sans text-[0.7rem] block text-brand-accent uppercase tracking-widest mb-1">Max
                                    Height (H)</strong> (u² sin² θ) / 2g</p>
                            <p class="hover:text-brand-accent transition-colors"><strong
                                    class="not-italic font-sans text-[0.7rem] block text-brand-accent uppercase tracking-widest mb-1">Flight
                                    Time (T)</strong> (2u sin θ) / g</p>
                        </div>

                        <!-- Pre-sets -->
                        <div class="pt-2 border-t border-brand-border">
                            <h4 class="text-[0.65rem] uppercase tracking-widest text-slate-500 font-bold mb-2">
                                Experimental Labs</h4>
                            <select id="sel-preset"
                                class="bg-brand-bg border border-brand-border text-slate-100 p-2 rounded text-xs w-full focus:ring-1 focus:ring-brand-accent">
                                <option value="">--- Load Preset ---</option>
                                <option value="max-range">Maximum Range (45°)</option>
                                <option value="moon-jump">Moon Gravity Lab</option>
                                <option value="air-drag-test">High Drag Experiment</option>
                                <option value="zero-g">Zero-G Linear Motion</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- Challenge Mode -->
                <section class="space-y-3">
                    <button id="btn-challenge-start"
                        class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-lg font-bold shadow-lg shadow-emerald-900/20 transition-all uppercase tracking-wider">Target
                        Practice</button>
                    <div id="challenge-info"
                        class="hidden grid grid-cols-2 gap-3 p-3 bg-emerald-500/5 border border-emerald-500/20 rounded-lg text-sm text-center">
                        <div class="bg-brand-bg/40 p-2 rounded">
                            <span class="block text-[0.6rem] text-slate-400 uppercase tracking-widest">Score</span>
                            <span id="score" class="text-xl font-bold text-emerald-400 leading-none">0</span>
                        </div>
                        <div class="bg-brand-bg/40 p-2 rounded">
                            <span class="block text-[0.6rem] text-slate-400 uppercase tracking-widest">Dist</span>
                            <span id="target-dist" class="text-xl font-bold text-emerald-400 leading-none">---</span>
                        </div>
                    </div>
                </section>
            </aside>
        </main>


        <footer class="text-center pb-2">
            <p class="text-xs text-slate-500">Built for A/L Physical Science Students • Sri Lanka</p>
        </footer>
    </div>

    <script>
        // Define Module before loading the Emscripten glue code
        window.Module = {
            onRuntimeInitialized: function () {
                console.log("WASM Runtime Initialized via index.html");
                window.wasmReady = true;
                if (window.onWasmReady) window.onWasmReady();
            }
        };
    </script>
    <script src="js/physics.js"></script>
    <script type="module" src="js/main.js"></script>
</body>

</html>